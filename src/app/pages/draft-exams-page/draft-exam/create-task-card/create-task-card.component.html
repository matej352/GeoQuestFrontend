<main>
  <div class="filters-container">
    <div class="filter-item">
      <p>Odaberite tip karte</p>
      <mat-form-field appearance="fill">
        <mat-select [(value)]="selection.selectedOption" disableOptionCentering>
          <mat-option
            [value]="option.value"
            *ngFor="let option of selection.otherOptions"
            (click)="onSelectMapType()"
            >{{ option.viewValue }}</mat-option
          >
        </mat-select>
      </mat-form-field>
    </div>
    <div class="filter-item">
      <p>Odaberite tip zadatka</p>
      <mat-form-field appearance="fill" class="task-type">
        <mat-select
          [(value)]="selection2.selectedOption"
          disableOptionCentering
        >
          <mat-option
            [value]="option.value"
            *ngFor="let option of selection2.otherOptions"
            (click)="onSelectTaskType()"
            >{{ option.viewValue }}</mat-option
          >
        </mat-select>
      </mat-form-field>
    </div>
    <fa-icon
      title="Odustani"
      mat-dialog-close
      [icon]="closeIcon"
      (click)="close()"
    ></fa-icon>
  </div>
  <div class="configuration-container">
    <ng-container [ngSwitch]="selectedTaskTypeOption">
      <ng-container *ngSwitchCase="'select_polygon'">
        <div class="left">
          <app-select-polygon-map
            [mapType]="selectedMapTypeOption"
            (onDrawnItemsChange)="drawnItemsChange($event)"
            mapId="select_polygon"
          ></app-select-polygon-map>
        </div>
        <div class="right">
          <form
            [formGroup]="taskForm"
            (ngSubmit)="submitSelectPolygonOrPoint('polygon')"
          >
            <div class="form-container">
              <div class="form-group-column">
                <label for="question"> Tekst zadatka </label>
                <app-quill-editor
                  formControlName="question"
                  errorMessage="Tekst zadatka"
                ></app-quill-editor>
              </div>
              <p
                class="validation"
                *ngIf="
                  selectPointOrPolygonMapHasAtLeastTwoPoints &&
                  !selectPointOrPolygonMapHasOneCorrect
                "
              >
                Točno jedna opcija (poligon) na karti mora biti označena kao
                točna
              </p>
              <p
                class="validation"
                *ngIf="!selectPointOrPolygonMapHasAtLeastTwoPoints"
              >
                Označite barem dvije opcije (poligoni) na karti
              </p>
              <div class="info-for-teacher">
                Označite opcije (poligoni) na karti od kojih jedna mora biti
                označena kao točna
              </div>
              <input
                class="submit"
                type="submit"
                value="Stvori"
                [disabled]="
                  !taskForm.valid ||
                  !selectPointOrPolygonMapHasOneCorrect ||
                  !selectPointOrPolygonMapHasAtLeastTwoPoints
                "
                [ngClass]="{
                  disabled:
                    !taskForm.valid ||
                    !selectPointOrPolygonMapHasOneCorrect ||
                    !selectPointOrPolygonMapHasAtLeastTwoPoints
                }"
              />
            </div>
          </form>
        </div>
      </ng-container>
      <ng-container *ngSwitchCase="'select_point'">
        <div class="left">
          <app-select-point-map
            [mapType]="selectedMapTypeOption"
            mapId="select_point"
            (onDrawnItemsChange)="drawnItemsChange($event)"
          ></app-select-point-map>
        </div>
        <div class="right">
          <form
            [formGroup]="taskForm"
            (ngSubmit)="submitSelectPolygonOrPoint('point')"
          >
            <div class="form-container">
              <div class="form-group-column">
                <label for="question"> Tekst zadatka </label>
                <app-quill-editor
                  formControlName="question"
                  errorMessage="Tekst zadatka"
                ></app-quill-editor>
              </div>
              <p
                class="validation"
                *ngIf="
                  selectPointOrPolygonMapHasAtLeastTwoPoints &&
                  !selectPointOrPolygonMapHasOneCorrect
                "
              >
                Točno jedna opcija (točka) na karti mora biti označena kao točna
              </p>
              <p
                class="validation"
                *ngIf="!selectPointOrPolygonMapHasAtLeastTwoPoints"
              >
                Označite barem dvije opcije (točke) na karti
              </p>
              <div class="info-for-teacher">
                Označite opcije (točke) na karti od kojih jedna mora biti
                označena kao točna
              </div>
              <input
                class="submit"
                type="submit"
                value="Stvori"
                [disabled]="
                  !taskForm.valid ||
                  !selectPointOrPolygonMapHasOneCorrect ||
                  !selectPointOrPolygonMapHasAtLeastTwoPoints
                "
                [ngClass]="{
                  disabled:
                    !taskForm.valid ||
                    !selectPointOrPolygonMapHasOneCorrect ||
                    !selectPointOrPolygonMapHasAtLeastTwoPoints
                }"
              />
            </div>
          </form>
        </div>
      </ng-container>
      <ng-container *ngSwitchCase="'mark_polygon'">
        <div class="left">
          <app-mark-polygon-map
            [mapType]="selectedMapTypeOption"
            (onPolygonMarked)="drawnItemChange($event)"
            mapId="mark_polygon"
          ></app-mark-polygon-map>
        </div>
        <div class="right">
          <form [formGroup]="taskForm" (ngSubmit)="submitMarkPolygon()">
            <div class="form-container">
              <div class="form-group-column">
                <label for="question"> Tekst zadatka </label>
                <app-quill-editor
                  formControlName="question"
                  errorMessage="Tekst zadatka"
                ></app-quill-editor>
              </div>
              <div class="info-for-teacher">
                Označite točan odgovor (poligon) na karti
              </div>
              <input
                class="submit"
                type="submit"
                value="Stvori"
                [disabled]="!taskForm.valid || !markedPolygon"
                [ngClass]="{ disabled: !taskForm.valid || !markedPolygon }"
              />
            </div>
          </form>
        </div>
      </ng-container>
      <ng-container *ngSwitchCase="'non_map'">
        <div class="left">
          <app-non-map-map
            [mapType]="selectedMapTypeOption"
            (onPointMarked)="markedPointChanged($event)"
            mapId="non_map"
          ></app-non-map-map>
        </div>
        <div class="right">
          <form [formGroup]="taskForm" (ngSubmit)="submitNonMap()">
            <div class="form-container">
              <div class="form-group-column">
                <label for="question"> Tekst zadatka </label>
                <app-quill-editor
                  formControlName="question"
                  errorMessage="Tekst zadatka"
                ></app-quill-editor>
              </div>
              <div class="info-for-teacher">
                Označite točku na karti gdje će učenik upisivati odgovor
              </div>
              <input
                class="submit"
                type="submit"
                value="Stvori"
                [disabled]="!taskForm.valid || !markedPoint"
                [ngClass]="{ disabled: !taskForm.valid || !markedPoint }"
              />
            </div>
          </form>
        </div>
      </ng-container>

      <ng-container *ngSwitchCase="'mark_point'">
        <div class="left">
          <app-mark-point-map
            [mapType]="selectedMapTypeOption"
            mapId="mark_point"
            (onPointMarked)="markedPointChanged($event)"
          ></app-mark-point-map>
        </div>
        <div class="right">
          <form [formGroup]="taskForm" (ngSubmit)="submitMarkPoint()">
            <div class="form-container">
              <div class="form-group-column">
                <label for="question"> Tekst zadatka </label>
                <app-quill-editor
                  formControlName="question"
                  errorMessage="Tekst zadatka"
                ></app-quill-editor>
              </div>
              <div class="info-for-teacher">
                Označite točan odgovor (točku) na karti
              </div>

              <input
                class="submit"
                type="submit"
                value="Stvori"
                [disabled]="!taskForm.valid || !markedPoint"
                [ngClass]="{ disabled: !taskForm.valid || !markedPoint }"
              />
            </div>
          </form>
        </div>
      </ng-container>
    </ng-container>
  </div>
</main>
